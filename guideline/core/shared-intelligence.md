# Shared Intelligence

Core patterns and knowledge embedded in all Guild commands.

---

## Core Orchestration Patterns

### Research-First Pattern
**Always**: Analyze → Research → Plan → Execute → Verify

Benefits:
- Prevents premature optimization
- Ensures informed decisions
- Reduces rework

### Parallel Execution Pattern
**Always**: Spawn independent tasks in ONE message

Benefits:
- 3-10x performance improvement
- Better context management
- Efficient resource usage

### Validation Pattern
**Always**: Verify completeness before reporting to user

Benefits:
- Catches issues early
- Prevents false positives
- Ensures quality

---

## Built-In Subagent Types

Claude Code provides specialized subagent types via Task tool:

### general-purpose
**Use for**: Research, implementation, verification, multi-step tasks
**Tools**: All (Read, Write, Edit, Glob, Grep, Bash, WebFetch, WebSearch, etc.)
**When**: Most tasks, especially documentation research and implementation

### Explore
**Use for**: Codebase exploration, file discovery, pattern identification
**Tools**: Glob, Grep, Read, Bash
**When**: Finding files, searching code, understanding codebase structure
**Thoroughness levels**: quick | medium | very thorough

### Plan
**Use for**: Task planning, approach design, strategy development
**Tools**: Glob, Grep, Read, Bash
**When**: Complex/unclear tasks needing explicit planning
**Note**: Uses ExitPlanMode to present plan for user approval

---

## Subagent Prompt Patterns

### Context-Rich Prompts
Include in every subagent prompt:
- Clear objective
- Relevant context (project info, constraints)
- Guidance on approach (how to think about it)
- Success criteria (measurable outcomes)
- Expected deliverables

### Template
```
"ULTRATHINK: [Objective]

Context:
[Project info, patterns, constraints]

Guidance:
[How to approach, quality expectations]

Success Criteria:
[What defines success]

Report: [Expected deliverables]"
```

---

## Skill System Patterns

### Skills vs Agents
**Skills** (Knowledge):
- Reusable pattern libraries
- Project-specific conventions
- Implementation guidelines
- Stored in `.claude/skills/guild/`
- Discovered by Claude Code natively

**Agents** (Execution):
- Specialized executors
- Domain expertise with defined scope
- Can reference skills
- Stored in `.claude/agents/guild/`
- Invoked via Task tool

### Official SKILL.md Format
Follow Claude Code's progressive loading architecture:
```yaml
---
name: skill-name
description: "When to use this skill"
model: inherit
tools: Read, Write, Edit
---

# Skill Content
Pattern descriptions, conventions, anti-patterns
```

**Structure**:
- Level 1: YAML frontmatter (metadata, always loaded)
- Level 2: SKILL.md content (<500 lines, loaded when relevant)
- Level 3: Additional files (DOCS.md, REFERENCE.md, on-demand)

---

## Tool Performance Awareness

### Quick Reference
**Fast (<1s)**: Read, Write, Edit (single file), Glob (simple patterns)
**Medium (1-5s)**: Grep (moderate codebase), multiple Reads
**Slow (5-30s)**: WebSearch, Context7, complex Grep, large Glob
**Very Slow (30s+)**: Bash (builds, tests), Task (subagent overhead), Playwright

### Optimization Tips
- Batch independent operations in one message
- Use Grep with `type` parameter to filter files
- Read with `offset`/`limit` for large files
- Prefer Edit over Write for modifications
- Use `run_in_background` for long operations (>30s)

---

## Agent Creation Guidance

### Dynamic Specialist Creation
**During /guild:setup**:
1. Analyze project (tech stack, patterns, architecture)
2. Detect needs (frontend? backend? testing? database?)
3. Generate specialists dynamically based on actual project
4. Create CLAUDE.md with project intelligence

**During /guild workflow**:
1. Assess if existing agents match task domain
2. If no match, create ephemeral specialist with project context
3. Inject relevant skills and conventions
4. Let specialist handle details with ultrathink

### Ephemeral Specialist Pattern
```javascript
Task({
  prompt: "ULTRATHINK: You are a specialist for [detected-domain].

          PROJECT CONTEXT:
          ${projectTechStack}
          ${projectPatterns}
          ${projectConventions}

          RELEVANT SKILLS:
          ${relevantSkills}

          YOUR TASK:
          ${task}

          Apply project conventions and discovered patterns.",
  subagent_type: "general-purpose",
  description: task
})
```

---

## CLAUDE.md Intelligence

### Project-Level Intelligence (Generated by Setup)
```markdown
# Project Intelligence

## Tech Stack
[Detected technologies, frameworks, versions]

## Architecture Patterns
[Discovered architectural approaches]

## Conventions
[Project-specific patterns and conventions]

## Available Specialists
[Dynamically created specialists with expertise areas]

## Common Workflows
[Frequently used commands and patterns]
```

**Purpose**: Single source of truth for project intelligence that all subagents can reference.

---

## Mandatory Requirements

**These are enforced, not advisory**:

1. **Parallel Execution**: ALL independent tasks in ONE message
2. **ULTRATHINK Keyword**: Start EVERY Task prompt with "ULTRATHINK: "
3. **Subagent Delegation**: Use Task tool for multi-step work
4. **Fresh Context**: Research documentation (Context7/WebSearch)
5. **Final Validation**: Verify before completion

Everything else is intelligent judgment based on ultrathink reasoning.

---

## Dynamic Patterns (Not Hardcoded)

### Error Recovery
Embed in prompts when needed:
```
"Handle errors intelligently:
- Analyze failures and try alternative approaches
- Retry with different strategies if first attempt fails
- Escalate with diagnosis if truly stuck"
```

### Risk Awareness
Embed when task involves risk:
```
"Risk awareness:
This involves [production/data/security].
Verify assumptions, test safely, be cautious."
```

### Research Iteration
Embed when research-intensive:
```
"Research strategy:
If initial search insufficient, try alternative terms.
Iterate until confident understanding achieved."
```

**Key**: These are guidance patterns for crafting prompts, not hardcoded protocols.

---

## Summary

Shared intelligence provides:
- **Core orchestration patterns** (research-first, parallel execution, validation)
- **Subagent types reference** (when to use each)
- **Prompt patterns** (how to craft intelligent delegation)
- **Skill system basics** (knowledge vs execution)
- **Tool performance awareness** (optimization tips)
- **Dynamic creation patterns** (specialists, skills, CLAUDE.md)
- **Mandatory requirements** (what's enforced)

**Not included**: Detailed protocols (belong in subagent prompts, created dynamically based on task needs).
